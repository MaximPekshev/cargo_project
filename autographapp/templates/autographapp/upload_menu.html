{% extends 'cargoapp/base.html' %}

{% block content %}
<div id="preloader" class="hidden" align="center">
    <div class="spinner-border" role="status" style="margin-top:15%;">
        <span class="sr-only">Loading...</span>
    </div>
</div> 
<div class="row justify-content-center mt-4">
    <div class="col-11 col-md-8 col-xl-6 shadow pt-5 pb-5 row justify-content-center">

        <div class="col-12 row justify-content-center mb-2">
            <div class="col-10 col-md-8 col-xl-6" style="padding-left: 0px; padding-right: 0px;">
                <input type="date" class="form-control" id="dateInput" placeholder="Example input">
            </div>
        </div>

        <div id="errorPlace" class="col-12 row justify-content-center mb-2">
        </div>    

        <div id="mainButton" class="col-12 row justify-content-center mb-2">
        </div>

        <div class="col-12 row justify-content-center mb-2 mt-2">
            <a class="btn btn-outline-primary col-10 col-md-8 col-xl-6" href="{% url 'show_menu_page' %}">Меню</a>
        </div>

        <div class="col-12 row justify-content-center mb-2 mt-2">
            <a class="btn btn-outline-primary col-10 col-md-8 col-xl-6" href="" data-bs-toggle="modal" data-bs-target="#modalLogout">Выйти</a>
        </div>

    </div> 
</div> 

<div class="modal fade" id="modalLogout" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="modalLogoutLabel" aria-hidden="true">
	<div class="modal-dialog modal-dialog-centered">
	  <div class="modal-content">
		<div class="modal-header">
		  <h5 class="modal-title" id="modalLogoutLabel">Вы уверены что хотите выйти?</h5>
		  <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
		</div>
		<div class="modal-footer">
		  <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Отмена</button>
		  <a href="{% url 'logout' %}" class="btn btn-primary">Выйти</a>
		</div>
	  </div>
	</div>
</div>
<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
<script type="text/javascript">

    window.onload = function() {
        document.getElementById('mainButton').innerHTML ='<a id="upload-button" class="btn btn-warning col-10 col-md-8 col-xl-6" href="#" >Загрузить</a>';
        document.getElementById('upload-button').addEventListener('click', uploadTacho, false);
    }

    const uploadTacho = async (evt) => {
        evt.preventDefault();
        let dateInput = document.getElementById('dateInput');
        if (dateInput != null&& !dateInput.value == "") {
            document.getElementById('errorPlace').innerHTML ='';
            let preloaderEl = document.getElementById('preloader');
            preloaderEl.classList.add('visible');
            preloaderEl.classList.remove('hidden');
            let response = await axios.get(`/autograph/upload/${dateInput.value}/`)
                .then(() => {
                    let preloaderEl = document.getElementById('preloader');
                    preloaderEl.classList.remove('visible');
                    preloaderEl.classList.add('hidden');
                    document.getElementById('errorPlace').innerHTML =`<p style="color:blue; text-align: center;" class="col-10 col-md-8 col-xl-6">Данные ${dateInput.value} успешно загружены!</p>`;
                }).catch((error) => {
                    console.log(error)
                })
        } else {
            document.getElementById('errorPlace').innerHTML ='<p style="color:red; text-align: center;" class="col-10 col-md-8 col-xl-6">Выберите дату!!</p>';
        }
        
    }
</script>
{% endblock %}